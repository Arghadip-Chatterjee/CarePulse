generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  name          String
  email         String    @unique
  phone         String?
  password      String    // Hashed password
  role          String    @default("patient") // "patient", "doctor", "admin"
  emailVerified DateTime?
  image         String?
  
  patient       Patient?
  doctor        Doctor?
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Patient {
  id                     String   @id @default(auto()) @map("_id") @db.ObjectId
  userId                 String   @unique @db.ObjectId
  user                   User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  name                   String
  email                  String
  phone                  String
  birthDate              DateTime
  gender                 String
  address                String
  occupation             String
  emergencyContactName   String
  emergencyContactNumber String
  insuranceProvider      String
  insurancePolicyNumber  String
  allergies              String?
  currentMedication      String?
  familyMedicalHistory   String?
  pastMedicalHistory     String?
  identificationType     String?
  identificationNumber   String?
  identificationDocumentId String?
  identificationDocumentUrl String?
  privacyConsent         Boolean
  
  appointments           Appointment[]
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
}

model Doctor {
  id                     String   @id @default(auto()) @map("_id") @db.ObjectId
  userId                 String?   @unique @db.ObjectId
  user                   User?     @relation(fields: [userId], references: [id], onDelete: Cascade)
  name                   String
  email                  String
  phone                  String
  specialization         String
  licenseNumber          String
  yearsOfExperience      String
  hospitalAffiliation    String
  consultationFee        String
  availableTimingsOnline String[]
  availableTimingsOffline String[]
  identificationType     String?
  identificationNumber   String?
  identificationDocumentId String?
  identificationDocumentUrl String?
  isVerified             Boolean  @default(false)
  
  appointments           Appointment[]
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
}

model Appointment {
  id                 String   @id @default(auto()) @map("_id") @db.ObjectId
  patientId          String   @db.ObjectId
  patient            Patient  @relation(fields: [patientId], references: [id])
  schedule           DateTime
  status             String
  doctorId           String   @db.ObjectId
  doctor             Doctor   @relation(fields: [doctorId], references: [id])
  reason             String
  note               String?
  userId             String
  cancellationReason String?
  appointmenttype    String?
  prescription       String[]
  meeting            String?
  hasVisited         Boolean  @default(false)
  
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model Prescription {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  prescription_url String
  fileId          String
  user_id         String
  uploaded_at     DateTime
  appointmentId   String?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model AIConsultation {
  id                    String   @id @default(auto()) @map("_id") @db.ObjectId
  userId                String
  patientId             String   @db.ObjectId
  prescriptionUrls      String[] // Cloudinary URLs of selected prescriptions
  conversationHistory   Json     // Array of {role, content} messages
  extractedInfo         Json?    // Structured data extracted by AI
  status                String   // "in_progress", "completed"
  consultationType      String   @default("text") // "text" or "voice"
  conversationSummary   String?  // AI-generated summary of voice consultation
  
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}